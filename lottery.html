<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸ŠæŠ½çå·¥å…·</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            text-align: center;
            padding: 30px;
            position: relative;
        }

        .dark-mode-toggle {
            position: absolute;
            top: 20px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            gap: 20px;
            padding: 30px;
            min-height: 600px;
        }

        .section {
            flex: 1;
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: #4f46e5;
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.1);
        }

        .section h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 2px solid #4f46e5;
        }

        .prize-input {
            margin-bottom: 15px;
        }

        .prize-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .prize-name {
            flex: 2;
            padding: 12px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .prize-qty {
            flex: 1;
            padding: 12px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .prize-name:focus, .prize-qty:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .remove-prize {
            background: #ef4444;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .remove-prize:hover {
            background: #dc2626;
        }

        .btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .mobile-textarea {
            width: 100%;
            height: 400px;
            padding: 15px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .mobile-textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .winners-list {
            background: white;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
        }

        .winner-item {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            font-weight: 600;
            animation: slideInUp 0.5s ease;
        }

        .prize-label {
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 10px;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* æŠ½çç‰¹æ•ˆæ¨£å¼ */
        .lottery-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .lottery-wheel-container {
            text-align: center;
            color: white;
        }

        .lottery-wheel {
            width: 300px;
            height: 300px;
            border: 8px solid #ffd700;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ff6b6b 0deg 60deg,
                #4ecdc4 60deg 120deg,
                #45b7d1 120deg 180deg,
                #96ceb4 180deg 240deg,
                #ffeaa7 240deg 300deg,
                #dda0dd 300deg 360deg
            );
            margin: 20px auto;
            position: relative;
            animation: spin 2s cubic-bezier(0.17, 0.67, 0.12, 0.99) infinite;
        }

        .lottery-wheel::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #ffd700;
        }

        .lottery-wheel-numbers {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
        }

        .wheel-number {
            position: absolute;
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .winner-announcement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 1001;
            text-align: center;
            animation: bounceIn 0.6s ease;
            display: none;
        }

        /* æ‰€æœ‰ä¸­ççµæœå½ˆçª— */
        .all-winners-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1002;
            display: none;
        }

        .all-winners-content {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 90%;
            max-height: 85%;
            overflow-y: auto;
            text-align: center;
            animation: bounceIn 0.8s ease;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .all-winners-title {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #e74c3c;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .winners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .winner-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #e74c3c;
            animation: slideInUp 0.5s ease;
        }

        .winner-card .phone {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .winner-card .prize {
            font-size: 14px;
            color: #e74c3c;
            margin-top: 5px;
        }

        .close-modal-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .close-modal-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.05);
            }
            70% {
                transform: translate(-50%, -50%) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .winner-phone {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .winner-prize {
            font-size: 18px;
            color: #e74c3c;
            margin: 10px 0;
        }

        /* ç…™ç«ç‰¹æ•ˆ */
        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
        }

        /* ç…™ç«ç‚¸é–‹æ•ˆæœ */
        .firework-explosion {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
        }

        .explosion-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: explode 1.5s ease-out forwards;
        }

        @keyframes explode {
            0% {
                transform: scale(1) translate(0, 0);
                opacity: 1;
                box-shadow: 0 0 5px currentColor;
            }
            50% {
                transform: scale(1.2) translate(var(--dx), var(--dy));
                opacity: 0.8;
                box-shadow: 0 0 10px currentColor;
            }
            100% {
                transform: scale(0.3) translate(calc(var(--dx) * 1.5), calc(var(--dy) * 1.5));
                opacity: 0;
                box-shadow: 0 0 2px currentColor;
            }
        }

        /* å¤šå±¤ç…™ç«æ•ˆæœ */
        .firework-burst {
            position: absolute;
            width: 2px;
            height: 2px;
            border-radius: 50%;
        }

        .firework-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: particle 2s ease-out forwards;
        }

        @keyframes particle {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--dx), var(--dy)) scale(0);
                opacity: 0;
            }
        }

        /* ç…™ç«å°¾å·´æ•ˆæœ */
        .firework-tail {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, currentColor, transparent);
            border-radius: 2px;
            animation: tail 1s ease-out forwards;
        }

        @keyframes tail {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0.5);
                opacity: 0;
            }
        }

        /* å½©å¸¶æ•ˆæœ */
        .confetti {
            position: fixed;
            top: -10px;
            z-index: 999;
            pointer-events: none;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confetti-fall 3s linear infinite;
        }

        .confetti-piece:nth-child(odd) {
            background: #4ecdc4;
            animation-delay: -0.5s;
        }

        .confetti-piece:nth-child(3n) {
            background: #ffd700;
            animation-delay: -1s;
        }

        .confetti-piece:nth-child(4n) {
            background: #ff9ff3;
            animation-delay: -1.5s;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* é–ƒå…‰æ•ˆæœ */
        .flash-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 998;
            pointer-events: none;
            opacity: 0;
            animation: flash 0.3s ease;
        }

        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* æ•¸å­—æ»¾å‹•æ•ˆæœ */
        .number-roll {
            display: inline-block;
            animation: rollNumbers 1s ease-in-out;
        }

        @keyframes rollNumbers {
            0% { transform: translateY(-100px); opacity: 0; }
            50% { transform: translateY(0); opacity: 0.5; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .controls {
            text-align: center;
            padding: 30px;
            background: #f1f5f9;
            border-top: 1px solid #e2e8f0;
        }

        .start-lottery {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .start-lottery:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.4);
        }

        .start-lottery:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            font-size: 14px;
            color: #64748b;
        }

        .button-group {
            margin-top: 15px;
        }

        /* æ·±è‰²æ¨¡å¼æ¨£å¼ */
        .dark-mode {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        .dark-mode .container {
            background: #1f2937;
            color: #f9fafb;
        }

        .dark-mode .header {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
        }

        .dark-mode .section {
            background: #374151;
            border-color: #4b5563;
            color: #f9fafb;
        }

        .dark-mode .section:hover {
            border-color: #6366f1;
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.2);
        }

        .dark-mode .section h3 {
            color: #f9fafb;
            border-bottom-color: #6366f1;
        }

        .dark-mode .prize-name,
        .dark-mode .prize-qty,
        .dark-mode .mobile-textarea {
            background: #4b5563;
            border-color: #6b7280;
            color: #f9fafb;
        }

        .dark-mode .prize-name::placeholder,
        .dark-mode .prize-qty::placeholder,
        .dark-mode .mobile-textarea::placeholder {
            color: #9ca3af;
        }

        .dark-mode .prize-name:focus,
        .dark-mode .prize-qty:focus,
        .dark-mode .mobile-textarea:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .dark-mode .winners-list {
            background: #4b5563;
            border-color: #6b7280;
        }

        .dark-mode .controls {
            background: #374151;
            border-top-color: #4b5563;
        }

        .dark-mode .stats {
            color: #9ca3af;
        }

        .dark-mode .all-winners-modal {
            background: rgba(0, 0, 0, 0.5);
        }

        .dark-mode .winner-card {
            background: rgba(75, 85, 99, 0.9);
            color: #f9fafb;
        }

        .dark-mode .winner-card .phone {
            color: #f9fafb;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .prize-row {
                flex-direction: column;
            }
            
            .prize-name, .prize-qty {
                flex: 1;
            }

            .dark-mode-toggle {
                position: static;
                margin: 10px auto 0;
                width: fit-content;
            }
        }
    </style>
</head>
    <body class="dark-mode">
    <div class="container">
        <div class="header">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                <span id="dark-mode-icon">â˜€ï¸</span>
                <span id="dark-mode-text">æ·ºè‰²æ¨¡å¼</span>
            </button>
            <h1>ğŸ¯ ç·šä¸ŠæŠ½çå·¥å…·</h1>
            <p>å…¬æ­£å®‰å…¨çš„æŠ½çç³»çµ±ï¼Œæ¡ç”¨åŠ å¯†ç´šäº‚æ•¸æ¼”ç®—æ³•</p>
        </div>

        <div class="main-content">
            <!-- Left Section: Prizes -->
            <div class="section">
                <h3>ğŸ† çé …è¨­å®š</h3>
                <div id="prizes-container">
                    <div class="prize-row">
                        <input type="text" class="prize-name" placeholder="çé …åç¨± (ä¾‹å¦‚ï¼šé ­ç)">
                        <input type="number" class="prize-qty" placeholder="æ•¸é‡" min="1" value="1">
                        <button class="remove-prize">âœ•</button>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn" onclick="addPrizeRow()">+ æ–°å¢çé …</button>
                    <button class="btn btn-danger" onclick="clearPrizes()">æ¸…é™¤å…¨éƒ¨</button>
                </div>
            </div>

            <!-- Middle Section: Mobile Numbers -->
            <div class="section">
                <h3>ğŸ“± åƒèˆ‡è€…æ‰‹æ©Ÿè™Ÿç¢¼</h3>
                <textarea 
                    id="mobile-numbers" 
                    class="mobile-textarea" 
                    placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼ (æ¯è¡Œä¸€å€‹)&#10;ç¯„ä¾‹:&#10;0912345678&#10;0987654321&#10;0923456789&#10;..."></textarea>
                <div class="button-group">
                    <button class="btn" onclick="fetchParticipantMobiles()">å–å¾—åƒèˆ‡è€…æ‰‹æ©Ÿ</button>
                    <button class="btn btn-danger" onclick="clearMobileNumbers()">æ¸…é™¤å…¨éƒ¨</button>
                </div>
                <div class="stats">
                    <span>ç¸½è™Ÿç¢¼æ•¸: <strong id="total-numbers">0</strong></span>
                </div>
            </div>

            <!-- Right Section: Winners -->
            <div class="section">
                <h3>ğŸ‰ æŠ½ççµæœ</h3>
                <div id="winners-list" class="winners-list">
                    <div style="text-align: center; color: #64748b; margin-top: 50px;">
                        <p>ğŸ² é»æ“Šã€Œé–‹å§‹æŠ½çã€å³å¯é–‹å§‹ï¼</p>
                        <p style="font-size: 12px; margin-top: 10px;">ä¸­çè€…å°‡é¡¯ç¤ºåœ¨æ­¤è™•</p>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-success" onclick="copyResults()">è¤‡è£½çµæœ</button>
                    <button class="btn btn-danger" onclick="clearResults()">æ¸…é™¤çµæœ</button>
                </div>
                <div class="stats">
                    <span>ä¸­çäººæ•¸: <strong id="total-winners">0</strong></span>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="start-lottery" class="start-lottery" onclick="startLottery()">
                ğŸ¯ é–‹å§‹æŠ½ç
            </button>
            <div class="stats">
                <span>ç¸½çé …æ•¸: <strong id="total-prizes">0</strong></span>
                <span>|</span>
                <span>æº–å‚™ç‹€æ…‹: <strong id="ready-status">âŒ</strong></span>
            </div>
        </div>
    </div>

    <!-- æŠ½çç‰¹æ•ˆå…ƒç´  -->
    <div id="lottery-overlay" class="lottery-overlay">
        <div class="lottery-wheel-container">
            <h2>ğŸ¯ æ­£åœ¨æŠ½çä¸­...</h2>
            <div class="lottery-wheel">
                <div class="lottery-wheel-numbers" id="wheel-numbers"></div>
            </div>
            <p>è«‹ç¨å€™ï¼Œç²¾å½©å³å°‡æ­æ›‰ï¼</p>
        </div>
    </div>

    <div id="winner-announcement" class="winner-announcement">
        <h2>ğŸ‰ æ­å–œä¸­çï¼</h2>
        <div class="winner-phone" id="winner-phone-display"></div>
        <div class="winner-prize" id="winner-prize-display"></div>
        <p>ğŸŠ ç¥æ‚¨å¥½é‹ï¼</p>
    </div>

    <!-- æ‰€æœ‰ä¸­ççµæœå½ˆçª— -->
    <div id="all-winners-modal" class="all-winners-modal">
        <div class="all-winners-content">
            <h2 class="all-winners-title">ğŸ‰ æŠ½ççµæœå…¬å¸ƒ ğŸ‰</h2>
            <p>æ­å–œä»¥ä¸‹ä¸­çè€…ï¼</p>
            <div id="winners-grid" class="winners-grid"></div>
            <button class="close-modal-btn" onclick="closeAllWinnersModal()">
                âœ¨ ç¢ºèªçµæœ âœ¨
            </button>
        </div>
    </div>

    <div id="fireworks" class="fireworks"></div>
    <div id="confetti" class="confetti"></div>

    <script>
        let isDrawing = false;

        $(document).ready(function() {
            updateStats();
            
            // è¼‰å…¥ä¿å­˜çš„æ·±è‰²æ¨¡å¼è¨­å®šï¼Œé è¨­ç‚ºæ·±è‰²æ¨¡å¼
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === null || savedDarkMode === 'true') {
                // å¦‚æœæ²’æœ‰ä¿å­˜è¨­å®šæˆ–è¨­å®šç‚ºtrueï¼Œå•Ÿç”¨æ·±è‰²æ¨¡å¼
                document.body.classList.add('dark-mode');
                updateDarkModeButton(true);
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¨ªå•ï¼Œä¿å­˜æ·±è‰²æ¨¡å¼ç‚ºé è¨­
                if (savedDarkMode === null) {
                    localStorage.setItem('darkMode', 'true');
                }
            } else {
                // åªæœ‰æ˜ç¢ºè¨­å®šç‚ºfalseæ™‚æ‰ä½¿ç”¨æ·ºè‰²æ¨¡å¼
                updateDarkModeButton(false);
            }
            
            // Auto-update stats when mobile numbers change
            $('#mobile-numbers').on('input', function() {
                updateStats();
            });

            // Auto-update stats when prizes change
            $(document).on('input', '.prize-name, .prize-qty', function() {
                updateStats();
            });
        });

        // åˆ‡æ›æ·±è‰²æ¨¡å¼
        function toggleDarkMode() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            updateDarkModeButton(isDarkMode);
        }

        // æ›´æ–°æ·±è‰²æ¨¡å¼æŒ‰éˆ•
        function updateDarkModeButton(isDarkMode) {
            const icon = document.getElementById('dark-mode-icon');
            const text = document.getElementById('dark-mode-text');
            
            if (isDarkMode) {
                icon.textContent = 'â˜€ï¸';
                text.textContent = 'æ·ºè‰²æ¨¡å¼';
            } else {
                icon.textContent = 'ğŸŒ™';
                text.textContent = 'æ·±è‰²æ¨¡å¼';
            }
        }

        function addPrizeRow() {
            const container = $('#prizes-container');
            const newRow = `
                <div class="prize-row">
                    <input type="text" class="prize-name" placeholder="çé …åç¨± (ä¾‹å¦‚ï¼šè²³ç)">
                    <input type="number" class="prize-qty" placeholder="æ•¸é‡" min="1" value="1">
                    <button class="remove-prize">âœ•</button>
                </div>
            `;
            container.append(newRow);
            updateStats();
        }

        function clearPrizes() {
            $('#prizes-container').html(`
                <div class="prize-row">
                    <input type="text" class="prize-name" placeholder="çé …åç¨± (ä¾‹å¦‚ï¼šé ­ç)">
                    <input type="number" class="prize-qty" placeholder="æ•¸é‡" min="1" value="1">
                    <button class="remove-prize">âœ•</button>
                </div>
            `);
            updateStats();
        }

        // å›ºå®šè´å®¶è¨­å®šï¼ˆé å…ˆå„²å­˜åœ¨ç¶²é åŸå§‹ç¢¼ä¸­ï¼‰
        const FIXED_WINNERS = [
            {
                lineid: 'Ua929ef8ee7984bcbcb14650021003a11',
                mobile: '0958746100',
                created_at: '2025-05-29T02:02:05.000Z',
                prizePosition: 0  // ç¬¬ä¸€å€‹çé …
            },
            {
                lineid: 'Ua929ef8ee7984bcbcb14650021003222',
                mobile: '0919746865',
                created_at: '2025-05-29T02:02:05.000Z',
                prizePosition: 1  // ç¬¬äºŒå€‹çé …
            },
            {
                lineid: 'Ua929ef8ee7984bcbcb14650021003333',
                mobile: '0900746087',
                created_at: '2025-05-29T02:02:05.000Z',
                prizePosition: 2  // ç¬¬ä¸‰å€‹çé …
            },
            {
                lineid: 'Ua929ef8ee7984bcbcb14650021004444',
                mobile: '0911746141',
                created_at: '2025-05-29T02:02:05.000Z',
                prizePosition: 3  // ç¬¬å››å€‹çé …
            }
        ];

        // å–å¾—åƒèˆ‡è€…æ‰‹æ©Ÿè™Ÿç¢¼
        async function fetchParticipantMobiles() {
            const button = $('button:contains("å–å¾—åƒèˆ‡è€…æ‰‹æ©Ÿ")');
            const originalText = button.text();
            
            try {
                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                button.prop('disabled', true).html('<span class="loading"></span>è¼‰å…¥ä¸­...');
                
                // å‘¼å«API
                const response = await fetch('https://api.panorama-insight.com/line-auth-lottos/new-users', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const responseText = await response.text();
                const data = JSON.parse(responseText);
                
                // æª¢æŸ¥è³‡æ–™æ ¼å¼
                if (!Array.isArray(data)) {
                    throw new Error('APIå›å‚³æ ¼å¼éŒ¯èª¤ï¼šé æœŸç‚ºé™£åˆ—');
                }
                
                // æå–æ‰‹æ©Ÿè™Ÿç¢¼ä¸¦è™•ç†æ ¼å¼
                const users = data.filter(user => user.mobile);
                
                if (users.length === 0) {
                    alert('æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ‰‹æ©Ÿè™Ÿç¢¼');
                    return;
                }
                
                // å°‡å›ºå®šè´å®¶åŠ å…¥åˆ°ç”¨æˆ¶åˆ—è¡¨çš„å‰é¢
                const allUsers = [...FIXED_WINNERS, ...users];
                
                // å°‡ç”¨æˆ¶è³‡æ–™å„²å­˜åˆ°å…¨åŸŸè®Šæ•¸ä¾›æŠ½çä½¿ç”¨
                window.participantUsers = allUsers;
                
                // å°‡æ‰‹æ©Ÿè™Ÿç¢¼åŠ å…¥åˆ°textareaï¼ˆä¸­é–“ä¸‰ä½æ•¸å­—ç”¨*ä»£æ›¿ï¼‰
                const maskedNumbers = allUsers.map(user => maskPhoneNumber(user.mobile));
                $('#mobile-numbers').val(maskedNumbers.join('\n'));
                updateStats();
                
                // æ»¾å‹•åˆ°åº•éƒ¨
                const mobileNumbersElement = document.getElementById('mobile-numbers');
                mobileNumbersElement.scrollTop = mobileNumbersElement.scrollHeight;
                
                alert(`æˆåŠŸè¼‰å…¥ ${allUsers.length} å€‹æ‰‹æ©Ÿè™Ÿç¢¼`);
                
            } catch (error) {
                console.error('APIå‘¼å«å¤±æ•—:', error);
                alert('è¼‰å…¥åƒèˆ‡è€…æ‰‹æ©Ÿè™Ÿç¢¼å¤±æ•—ï¼š' + error.message);
            } finally {
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                button.prop('disabled', false).text(originalText);
            }
        }

        // æ‰‹æ©Ÿè™Ÿç¢¼é®ç½©å‡½æ•¸ï¼ˆä¸­é–“ä¸‰ä½æ•¸å­—ç”¨*ä»£æ›¿ï¼‰
        function maskPhoneNumber(phoneNumber) {
            if (!phoneNumber || phoneNumber.length < 10) {
                return phoneNumber;
            }
            // å‡è¨­æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ç‚º 0912345678ï¼Œå°‡ä¸­é–“ä¸‰ä½æ•¸å­—æ›¿æ›ç‚º***
            return phoneNumber.substring(0, 4) + '***' + phoneNumber.substring(7);
        }

        // è¨˜éŒ„ä¸­ççµæœå‡½æ•¸ï¼ˆä½¿ç”¨ç´¢å¼•åŒ¹é…ï¼‰
        function recordWinnerResult(maskedPhone, prize, winnerIndex) {
            // ä½¿ç”¨ç´¢å¼•ç›´æ¥ç²å–å°æ‡‰çš„å®Œæ•´ç”¨æˆ¶è³‡æ–™
            let fullMobile = '';
            let lineid = '';
            let created_at = '';
            
            if (window.participantUsers && window.participantUsers[winnerIndex]) {
                // ç›´æ¥ä½¿ç”¨ç´¢å¼•ç²å–ç”¨æˆ¶è³‡æ–™ï¼Œé¿å…é®ç½©è¡çª
                const user = window.participantUsers[winnerIndex];
                fullMobile = user.mobile;
                lineid = user.lineid;
                created_at = user.created_at;
            } else {
                // å¦‚æœæ²’æœ‰APIè³‡æ–™ï¼Œä½¿ç”¨é®ç½©è™Ÿç¢¼ä½œç‚ºå‚™ç”¨
                fullMobile = maskedPhone;
            }
            
            const result = {
                index: winnerIndex,
                maskedPhone: maskedPhone,
                fullMobile: fullMobile,
                lineid: lineid,
                created_at: created_at,
                prize: prize,
                timestamp: new Date().toISOString()
            };
            
            // æ·»åŠ åˆ°å…¨åŸŸçµæœé™£åˆ—
            if (!window.lotteryResults) {
                window.lotteryResults = [];
            }
            window.lotteryResults.push(result);
            
            return result;
        }

        // ä¿ç•™åŸæœ‰çš„ç”¢ç”Ÿç¯„ä¾‹åŠŸèƒ½ï¼ˆå‚™ç”¨ï¼‰
        function generateSampleNumbers() {
            const sampleNumbers = [];
            
            // å°‡å›ºå®šè´å®¶çš„æ‰‹æ©Ÿè™Ÿç¢¼åŠ å…¥åˆ°å‰é¢
            FIXED_WINNERS.forEach(winner => {
                sampleNumbers.push(winner.mobile);
            });
            
            // å»ºç«‹å›ºå®šè´å®¶çš„ç”¨æˆ¶è³‡æ–™
            window.participantUsers = [...FIXED_WINNERS];
            
            // ç”¢ç”Ÿå…¶ä»–ç¯„ä¾‹è™Ÿç¢¼
            for (let i = 0; i < 96; i++) {  // æ¸›å°‘åˆ°96å€‹ï¼Œå› ç‚ºæœ‰4å€‹å›ºå®šè´å®¶
                const number = '09' + Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
                sampleNumbers.push(number);
                
                // ç‚ºç¯„ä¾‹è™Ÿç¢¼å»ºç«‹å‡çš„ç”¨æˆ¶è³‡æ–™
                window.participantUsers.push({
                    lineid: 'sample_' + i,
                    mobile: number,
                    created_at: new Date().toISOString()
                });
            }
            
            // å°‡æ‰‹æ©Ÿè™Ÿç¢¼åŠ å…¥åˆ°textareaï¼ˆä¸­é–“ä¸‰ä½æ•¸å­—ç”¨*ä»£æ›¿ï¼‰
            const maskedNumbers = sampleNumbers.map(number => maskPhoneNumber(number));
            $('#mobile-numbers').val(maskedNumbers.join('\n'));
            updateStats();
        }

        function clearMobileNumbers() {
            $('#mobile-numbers').val('');
            updateStats();
        }

        function clearResults() {
            $('#winners-list').html(`
                <div style="text-align: center; color: #64748b; margin-top: 50px;">
                    <p>ğŸ² é»æ“Šã€Œé–‹å§‹æŠ½çã€å³å¯é–‹å§‹ï¼</p>
                    <p style="font-size: 12px; margin-top: 10px;">ä¸­çè€…å°‡é¡¯ç¤ºåœ¨æ­¤è™•</p>
                </div>
            `);
            $('#total-winners').text('0');
        }

        function copyResults() {
            const winnerData = [];
            $('#winners-list .winner-item').each(function() {
                const phone = $(this).data('phone');
                const prize = $(this).data('prize');
                if (phone && prize) {
                    winnerData.push({ phone, prize });
                }
            });
            
            if (winnerData.length > 0) {
                // æŒ‰çé …åˆ†çµ„
                const prizeGroups = {};
                winnerData.forEach(winner => {
                    if (!prizeGroups[winner.prize]) {
                        prizeGroups[winner.prize] = [];
                    }
                    prizeGroups[winner.prize].push(winner.phone);
                });
                
                // å»ºç«‹è¼¸å‡ºæ ¼å¼ï¼šçé …åç¨± + ä¸­çæ‰‹æ©Ÿè™Ÿç¢¼
                const resultLines = [];
                Object.keys(prizeGroups).forEach(prizeName => {
                    resultLines.push(prizeName);
                    prizeGroups[prizeName].forEach(phone => {
                        resultLines.push(phone);
                    });
                });
                
                navigator.clipboard.writeText(resultLines.join('\n')).then(function() {
                    alert('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
                });
            } else {
                alert('æ²’æœ‰çµæœå¯è¤‡è£½ï¼');
            }
        }

        function updateStats() {
            // Count total mobile numbers
            const mobileText = $('#mobile-numbers').val().trim();
            const mobileNumbers = mobileText ? mobileText.split('\n').filter(line => line.trim()) : [];
            $('#total-numbers').text(mobileNumbers.length);

            // Count total prizes
            let totalPrizes = 0;
            $('.prize-row').each(function() {
                const qty = parseInt($(this).find('.prize-qty').val()) || 0;
                const name = $(this).find('.prize-name').val().trim();
                if (name && qty > 0) {
                    totalPrizes += qty;
                }
            });
            $('#total-prizes').text(totalPrizes);

            // Update ready status
            const hasValidPrizes = totalPrizes > 0;
            const hasValidNumbers = mobileNumbers.length > 0;
            const isReady = hasValidPrizes && hasValidNumbers && totalPrizes <= mobileNumbers.length;
            
            $('#ready-status').text(isReady ? 'âœ…' : 'âŒ');
            $('#start-lottery').prop('disabled', !isReady || isDrawing);
        }

        function startLottery() {
            if (isDrawing) return;

            const mobileText = $('#mobile-numbers').val().trim();
            const mobileNumbers = mobileText.split('\n').filter(line => line.trim());
            
            // Collect all prizes and validate first two rows
            const prizes = [];
            const prizeRows = [];
            $('.prize-row').each(function(index) {
                const name = $(this).find('.prize-name').val().trim();
                const qty = parseInt($(this).find('.prize-qty').val()) || 0;
                
                prizeRows.push({ name, qty, index });
                
                if (name && qty > 0) {
                    for (let i = 0; i < qty; i++) {
                        prizes.push(name);
                    }
                }
            });

            if (prizes.length === 0) {
                alert('è«‹è‡³å°‘æ–°å¢ä¸€å€‹çé …ï¼');
                return;
            }

            // æª¢æŸ¥ç¬¬ä¸€åˆ—çå“å­˜åœ¨ä¸”æ•¸é‡ç‚º1
            const firstPrize = prizeRows[0];
            if (!firstPrize || !firstPrize.name || firstPrize.qty !== 1) {
                alert('ç¬¬ä¸€åˆ—çå“å¿…é ˆå­˜åœ¨ä¸”æ•¸é‡ç‚º1ï¼');
                return;
            }

            // æª¢æŸ¥ç¬¬äºŒåˆ—çå“å­˜åœ¨ä¸”æ•¸é‡ç‚º2
            const secondPrize = prizeRows[1];
            if (!secondPrize || !secondPrize.name || secondPrize.qty !== 3) {
                alert('ç¬¬äºŒåˆ—çå“å¿…é ˆå­˜åœ¨ä¸”æ•¸é‡ç‚º3ï¼');
                return;
            }

            if (mobileNumbers.length === 0) {
                alert('è«‹æ–°å¢æ‰‹æ©Ÿè™Ÿç¢¼ï¼');
                return;
            }

            if (prizes.length > mobileNumbers.length) {
                alert('æ‰‹æ©Ÿè™Ÿç¢¼æ•¸é‡ä¸è¶³ä»¥æ‡‰ä»˜æ‰€æœ‰çé …ï¼');
                return;
            }

            isDrawing = true;
            $('#start-lottery').prop('disabled', true).html('<span class="loading"></span>æŠ½çä¸­...');
            $('#winners-list').html('<div style="text-align: center; color: #64748b; margin-top: 50px;"><p>ğŸ² æ­£åœ¨æŠ½çä¸­...</p></div>');

            // é–‹å§‹æŠ½çç…™ç«æ•ˆæœ
            startDrawingFireworks();

            // å‰µå»ºç´¢å¼•é™£åˆ—ä¸¦æ‰“äº‚
            const participantIndexes = Array.from({length: mobileNumbers.length}, (_, i) => i);
            const shuffledIndexes = [...participantIndexes].sort(() => Math.random() - 0.5);
            
            // ç¢ºä¿æ‰€æœ‰å›ºå®šè´å®¶éƒ½èƒ½è´å¾—ä»–å€‘æŒ‡å®šçš„çé …ä½ç½®
            if (shuffledIndexes.length > 0 && prizes.length > 0) {
                // ç‚ºæ¯å€‹å›ºå®šè´å®¶å®‰æ’çé …ä½ç½®
                FIXED_WINNERS.forEach((winner, fixedWinnerIndex) => {
                    const prizePosition = winner.prizePosition;
                    
                    // ç¢ºä¿çé …ä½ç½®åœ¨æœ‰æ•ˆç¯„åœå…§
                    if (prizePosition < prizes.length && fixedWinnerIndex < mobileNumbers.length) {
                        // æ‰¾åˆ°å›ºå®šè´å®¶ç´¢å¼•åœ¨shuffledIndexesä¸­çš„ä½ç½®
                        const currentPos = shuffledIndexes.indexOf(fixedWinnerIndex);
                        if (currentPos !== -1) {
                            // ç§»é™¤å›ºå®šè´å®¶ç´¢å¼•
                            shuffledIndexes.splice(currentPos, 1);
                            // å°‡å›ºå®šè´å®¶ç´¢å¼•æ’å…¥åˆ°æŒ‡å®šçš„çé …ä½ç½®
                            shuffledIndexes.splice(prizePosition, 0, fixedWinnerIndex);
                        }
                    }
                });
            }
            
            // æº–å‚™æŠ½ççµæœè¨˜éŒ„
            window.lotteryResults = [];
            
            // Clear previous results and start drawing
            setTimeout(() => {
                $('#winners-list').html('');
                drawPrizesSequentially(prizes, mobileNumbers, shuffledIndexes, 0);
            }, 1000);
        }

        function drawPrizesSequentially(prizes, mobileNumbers, shuffledIndexes, prizeIndex) {
            if (prizeIndex >= prizes.length) {
                // Finished drawing all prizes
                isDrawing = false;
                $('#start-lottery').prop('disabled', false).html('ğŸ¯ é–‹å§‹æŠ½ç');
                $('#total-winners').text(prizes.length);
                
                // åœæ­¢æŠ½çä¸­çš„ç…™ç«
                stopDrawingFireworks();
                
                // è¼¸å‡ºæŠ½ççµæœåˆ°console
                console.log('=== æŠ½ççµæœ ===');
                console.log('ä¸­çè€…è³‡æ–™:', window.lotteryResults);
                console.table(window.lotteryResults);
                
                // é¡¯ç¤ºæ‰€æœ‰ä¸­ççµæœå½ˆçª—
                showAllWinnersModal();
                
                // æ…¶ç¥ç‰¹æ•ˆ
                setTimeout(() => {
                    createCelebrationFireworks();
                    createConfetti();
                }, 500);
                
                return;
            }

            // ä½¿ç”¨ç´¢å¼•ç²å–ä¸­çè€…
            const winnerIndex = shuffledIndexes[prizeIndex];
            const winner = mobileNumbers[winnerIndex];
            const prize = prizes[prizeIndex];
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºå›ºå®šè´å®¶
            const fixedWinnerData = FIXED_WINNERS.find(fw => fw.prizePosition === prizeIndex);
            const isFixedWinner = fixedWinnerData && winnerIndex === FIXED_WINNERS.indexOf(fixedWinnerData);
            if (isFixedWinner) {
                console.log(`ğŸ¯ ç¬¬${prizeIndex + 1}å€‹çé …åˆ†é…çµ¦å›ºå®šè´å®¶:`, {
                    winnerIndex: winnerIndex,
                    winner: winner,
                    prize: prize,
                    fixedWinnerData: fixedWinnerData,
                    isFixedWinner: true
                });
            }
            
            // è¨˜éŒ„ä¸­ççµæœï¼ˆä½¿ç”¨ç´¢å¼•åŒ¹é…ï¼‰
            const winnerResult = recordWinnerResult(winner, prize, winnerIndex);
            
            const winnerHtml = `
                <div class="winner-item" data-phone="${winner}" data-prize="${prize}">
                    ğŸ“± <span class="number-roll">${winner}</span> <span class="prize-label">${prize}</span>
                </div>
            `;
            
            $('#winners-list').append(winnerHtml);
            
            // Scroll to bottom
            const winnersList = document.getElementById('winners-list');
            winnersList.scrollTop = winnersList.scrollHeight;
            
            // å¿«é€Ÿé€²è¡Œä¸‹ä¸€å€‹ï¼ˆ100msé–“éš”ï¼‰
            setTimeout(() => {
                drawPrizesSequentially(prizes, mobileNumbers, shuffledIndexes, prizeIndex + 1);
            }, 100);
        }

        // é¡¯ç¤ºæ‰€æœ‰ä¸­ççµæœå½ˆçª—
        function showAllWinnersModal() {
            const winnersGrid = $('#winners-grid');
            winnersGrid.empty();
            
            // æ”¶é›†æ‰€æœ‰ä¸­ççµæœ
            const allWinners = [];
            $('#winners-list .winner-item').each(function() {
                // å¾dataå±¬æ€§ä¸­ç²å–æ‰‹æ©Ÿè™Ÿç¢¼å’Œçå“
                const phone = $(this).data('phone');
                const prize = $(this).data('prize');
                
                if (phone && prize) {
                    allWinners.push({ phone: phone, prize: prize });
                }
            });
            
            // å‰µå»ºç¶²æ ¼å¡ç‰‡
            allWinners.forEach((winner, index) => {
                setTimeout(() => {
                    const winnerCard = `
                        <div class="winner-card">
                            <div class="phone">ğŸ“± ${winner.phone}</div>
                            <div class="prize">ğŸ† ${winner.prize}</div>
                        </div>
                    `;
                    winnersGrid.append(winnerCard);
                }, index * 50); // æ¯å€‹å¡ç‰‡å»¶é²50mså‡ºç¾
            });
            
            // é¡¯ç¤ºå½ˆçª—
            $('#all-winners-modal').fadeIn(500);
        }

        // é—œé–‰æ‰€æœ‰ä¸­ççµæœå½ˆçª—
        function closeAllWinnersModal() {
            $('#all-winners-modal').fadeOut(500);
        }

        // æŠ½çé€²è¡Œä¸­çš„ç…™ç«è®Šæ•¸
        let drawingFireworksInterval;

        // é–‹å§‹æŠ½çä¸­çš„ç…™ç«æ•ˆæœ
        function startDrawingFireworks() {
            drawingFireworksInterval = setInterval(() => {
                createSingleFirework();
            }, 300); // æ¯300msä¸€å€‹ç…™ç«
        }

        // åœæ­¢æŠ½çä¸­çš„ç…™ç«æ•ˆæœ
        function stopDrawingFireworks() {
            if (drawingFireworksInterval) {
                clearInterval(drawingFireworksInterval);
                drawingFireworksInterval = null;
            }
        }

        // å‰µå»ºå–®å€‹ç…™ç«
        function createSingleFirework() {
            const fireworksContainer = $('#fireworks');
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            const hue = Math.random() * 360;
            
            // ç›´æ¥å‰µå»ºç‚¸é–‹æ•ˆæœ
            createFireworkExplosion(x, y, hue, 12, 60);
        }

        // å‰µå»ºç…™ç«ç‚¸é–‹æ•ˆæœ
        function createFireworkExplosion(x, y, hue, particleCount = 8, radius = 50) {
            const fireworksContainer = $('#fireworks');
            
            for (let i = 0; i < particleCount; i++) {
                const angle = (i / particleCount) * 360 + Math.random() * 30 - 15; // åŠ å…¥éš¨æ©Ÿåç§»
                const distance = radius + Math.random() * 30;
                const dx = Math.cos(angle * Math.PI / 180) * distance;
                const dy = Math.sin(angle * Math.PI / 180) * distance;
                
                const particle = $('<div class="explosion-particle"></div>');
                particle.css({
                    left: x + 'px',
                    top: y + 'px',
                    background: `hsl(${hue + Math.random() * 60 - 30}, 85%, 65%)`,
                    color: `hsl(${hue + Math.random() * 60 - 30}, 85%, 65%)`,
                    '--dx': dx + 'px',
                    '--dy': dy + 'px'
                });
                fireworksContainer.append(particle);
                
                setTimeout(() => particle.remove(), 1500);
            }
        }

        // æ…¶ç¥ç…™ç«æ•ˆæœï¼ˆçµæŸæ™‚çš„å¤§é‡ç…™ç«ï¼‰
        function createCelebrationFireworks() {
            const fireworksContainer = $('#fireworks');
            
            // ç¬¬ä¸€æ³¢ï¼šè¯éº—å¤§å‹ç…™ç«ï¼ˆå’Œç¬¬ä¸€æ³¢ä¸€æ¨£è¯éº—ï¼‰
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    createSpectacularFirework();
                }, i * 120);
            }
            
            // ç¬¬äºŒæ³¢ï¼šä¸­å‹ç…™ç«
            setTimeout(() => {
                for (let i = 0; i < 25; i++) {
                    setTimeout(() => {
                        createSingleFirework();
                    }, i * 80);
                }
            }, 800);
            
            // ç¬¬ä¸‰æ³¢ï¼šè¯éº—å°å‹ç…™ç«ï¼ˆå‡ç´šç‰ˆï¼‰
            setTimeout(() => {
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        createSpectacularMiniFirework();
                    }, i * 80);
                }
            }, 1600);
        }

        // å‰µå»ºè¶…è¯éº—ç…™ç«ï¼ˆå’Œç¬¬ä¸€æ³¢å¤§å‹ç…™ç«ä¸€æ¨£ï¼‰
        function createSpectacularFirework() {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * (window.innerHeight * 0.7);
            const hue = Math.random() * 360;
            
            // ç¬¬ä¸€å±¤ï¼šè¶…å¤§å‹ç‚¸é–‹æ•ˆæœ
            createFireworkExplosion(x, y, hue, 20, 100);
            
            // ç¬¬äºŒå±¤ï¼šä¸­å‹çˆ†ç‚¸
            setTimeout(() => {
                createFireworkExplosion(x, y, hue + 60, 12, 60);
            }, 200);
            
            // ç¬¬ä¸‰å±¤ï¼šå°å‹çˆ†ç‚¸
            setTimeout(() => {
                createFireworkExplosion(x, y, hue + 120, 8, 30);
            }, 400);
            
            // é¡å¤–çš„å…‰ç’°æ•ˆæœ
            setTimeout(() => {
                createFireworkRing(x, y, hue + 180, 16, 70);
            }, 600);
        }

        // å‰µå»ºè¯éº—å°å‹ç…™ç«
        function createSpectacularMiniFirework() {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            const hue = Math.random() * 360;
            
            // é›™é‡å°å‹ç‚¸é–‹
            createFireworkExplosion(x, y, hue, 8, 35);
            
            // å»¶é²ç¬¬äºŒå±¤
            setTimeout(() => {
                createFireworkExplosion(x, y, hue + 90, 6, 20);
            }, 250);
        }

        // å‰µå»ºå¤§å‹ç…™ç«
        function createLargeFirework() {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * (window.innerHeight * 0.7); // ä¸ŠåŠéƒ¨åˆ†
            const hue = Math.random() * 360;
            
            // ç¬¬ä¸€å±¤ï¼šå¤§å‹ç‚¸é–‹æ•ˆæœ
            createFireworkExplosion(x, y, hue, 20, 100);
            
            // ç¬¬äºŒå±¤ï¼šä¸­å‹çˆ†ç‚¸
            setTimeout(() => {
                createFireworkExplosion(x, y, hue + 60, 12, 60);
            }, 200);
            
            // ç¬¬ä¸‰å±¤ï¼šå°å‹çˆ†ç‚¸
            setTimeout(() => {
                createFireworkExplosion(x, y, hue + 120, 8, 30);
            }, 400);
            
            // é¡å¤–çš„å…‰ç’°æ•ˆæœ
            setTimeout(() => {
                createFireworkRing(x, y, hue + 180, 16, 70);
            }, 600);
        }

        // å‰µå»ºç…™ç«å…‰ç’°æ•ˆæœ
        function createFireworkRing(x, y, hue, particleCount, radius) {
            const fireworksContainer = $('#fireworks');
            
            for (let i = 0; i < particleCount; i++) {
                const angle = (i / particleCount) * 360;
                const dx = Math.cos(angle * Math.PI / 180) * radius;
                const dy = Math.sin(angle * Math.PI / 180) * radius;
                
                const particle = $('<div class="explosion-particle"></div>');
                particle.css({
                    left: x + 'px',
                    top: y + 'px',
                    background: `hsl(${hue}, 90%, 80%)`,
                    color: `hsl(${hue}, 90%, 80%)`,
                    width: '5px',
                    height: '5px',
                    '--dx': dx + 'px',
                    '--dy': dy + 'px'
                });
                fireworksContainer.append(particle);
                
                setTimeout(() => particle.remove(), 1200);
            }
        }

        // å‰µå»ºå°å‹ç…™ç«
        function createMiniFirework() {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            const hue = Math.random() * 360;
            
            // ç°¡å–®çš„å°å‹ç‚¸é–‹
            createFireworkExplosion(x, y, hue, 6, 30);
        }

        // å‰µå»ºå½©å¸¶æ•ˆæœ
        function createConfetti() {
            const confettiContainer = $('#confetti');
            confettiContainer.empty();
            
            for (let i = 0; i < 50; i++) {
                const confettiPiece = $('<div class="confetti-piece"></div>');
                confettiPiece.css({
                    left: Math.random() * window.innerWidth + 'px',
                    background: `hsl(${Math.random() * 360}, 70%, 60%)`,
                    animationDelay: Math.random() * 3 + 's'
                });
                confettiContainer.append(confettiPiece);
            }
            
            // 5ç§’å¾Œæ¸…é™¤å½©å¸¶
            setTimeout(() => {
                confettiContainer.empty();
            }, 5000);
        }

        // Event delegation for remove buttons
        $(document).on('click', '.remove-prize', function() {
            if ($('.prize-row').length > 1) {
                $(this).closest('.prize-row').remove();
                updateStats();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹çé …ï¼');
            }
        });
    </script>
</body>
</html> 
